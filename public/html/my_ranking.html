<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>내 랭킹</title>
</head>
<body>
    <form action="">
        <input type="text" name="score">
        <input type="submit" value="가져오기">
    </form>
    <h1>테스트 랭킹 가져오기</h1>
    <div id="ranking"></div>
    <script>
        const url_string = window.location.href
        const urlObject = new URL(url_string)
        const urlParams = urlObject.search
        const rankingDiv = document.getElementById("ranking")
        const xhr = new XMLHttpRequest();
        const url = "http://localhost:9902/api/v1/my_ranking"+urlParams
        const method = "GET"

        if(urlParams){
            const resultEl = document.createElement("div")
            xhr.onload = function() {
                if(xhr.readyState === xhr.DONE){
                    if(xhr.status === 200 || xhr.status === 201){
                        let result = xhr.responseText
                        result = JSON.parse(result)
                        resultEl.innerHTML = result.ranking+"등"
                        rankingDiv.appendChild(resultEl)
                    }else{
                        console.error(xhr.responseText)
                    }
                }
            }
            if(xhr.readyState === xhr.UNSENT){
                resultEl.innerHTML = "순위권에 들지 못하였습니다.."
                rankingDiv.appendChild(resultEl)
            }
            xhr.open(method, url)
            xhr.send()
        }

    </script>
</body>
</html>